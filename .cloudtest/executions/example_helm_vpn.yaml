---
executions:
  - name: "Example-helm-vpn"
    kind: shell
    timeout: 300
    env:
      - NSM_NAMESPACE=nsm-system
      - CLUSTER_RULES_PREFIX=null
      - ARCHIVE_ARTIFACTS=true
      - ARTIFACTS_DIR=/home/circleci/project/.tests/cloud_test/$(cluster-name)/$(test-name)
      - SPIRE_ENABLED=false  # because spire is already installed
    kubernetes-env:
      - KUBECONFIG
    run: |
      scripts/helm-test-charts.sh nsm admission-webhook vpn
    on-test-fail: |
      make k8s-delete-nsm-namespaces
