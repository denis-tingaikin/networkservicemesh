---
executions:
  - name: "Interdomain tests packet-aws"
    env:
      - ARCHIVE_ARTIFACTS=true
      - ARTIFACTS_DIR=/home/circleci/project/.tests/cloud_test/$(cluster-name)/$(test-name)
    source:
      tags:
        - interdomain
    root: ./test/integration
    timeout: 600
    cluster-count: 2
    cluster-selector:
      - packet
      - aws
    kubernetes-env:
      - KUBECONFIG_CLUSTER_1
      - KUBECONFIG_CLUSTER_2
    on-test-fail: |
      make k8s-delete-nsm-namespaces
  - name: "Interdomain tests gke-packet"
    env:
      - ARCHIVE_ARTIFACTS=true
      - ARTIFACTS_DIR=/home/circleci/project/.tests/cloud_test/$(cluster-name)/$(test-name)
    tags:
      - interdomain
    root: ./test/integration
    timeout: 600
    cluster-count: 2
    cluster-selector:
      - gke
      - packet
    kubernetes-env:
      - KUBECONFIG_CLUSTER_1
      - KUBECONFIG_CLUSTER_2
    on-test-fail: |
      make k8s-delete-nsm-namespaces
  - name: "Interdomain tests azure-gke"
    env:
      - ARTIFACTS_DIR=/home/circleci/project/.tests/cloud_test/$(cluster-name)/$(test-name)
      - NSM_NAMESPACE=nsm-system
    tags:
      - interdomain
    root: ./test/integration
    timeout: 600
    cluster-count: 2
    cluster-selector:
      - azure
      - gke
    kubernetes-env:
      - KUBECONFIG_CLUSTER_1
      - KUBECONFIG_CLUSTER_2
    on-test-fail: |
      make k8s-delete-nsm-namespaces
  - name: "Interdomain tests aws-azure"
    env:
      - ARCHIVE_ARTIFACTS=true
      - ARTIFACTS_DIR=/home/circleci/project/.tests/cloud_test/$(cluster-name)/$(test-name)
    tags:
      - interdomain
    root: ./test/integration
    timeout: 600
    cluster-count: 2
    cluster-selector:
      - aws
      - azure
    kubernetes-env:
      - KUBECONFIG_CLUSTER_1
      - KUBECONFIG_CLUSTER_2
    on-test-fail: |
      make k8s-delete-nsm-namespaces
  - name: "Interdomain suite tests packet-aws"
    env:
      - ARCHIVE_ARTIFACTS=true
      - ARTIFACTS_DIR=/home/circleci/project/.tests/cloud_test/$(cluster-name)/$(test-name)
      - FIXED_NAMESPACE=true
    source:
      tags:
        - interdomain
    after-all: |
      make k8s-delete-nsm-namespaces
    root: ./test/integration
    timeout: 600
    cluster-count: 2
    cluster-selector:
      - packet
      - aws
    kubernetes-env:
      - KUBECONFIG_CLUSTER_1
      - KUBECONFIG_CLUSTER_2
    on-test-fail: |
      make k8s-delete-nsm-namespaces
